# Script to create the training file


## 1 - filterByCity.py (optional)
	
Filters the records of a specific city, for example, Curitiba.

```
python <inputfile>  <targetfile> <city>

python waze.gz waze_curitiba.json curitiba
```

## 2 - filterSpatioTemporalData.py (optional)

Filters the records of which are Spatio-Temporal. 


```
 python <inputfile>  <targetfile>
```


## 3 - preprocessing.py (mandatory)


Reads the output generated by the previous filter (or the original) and given the selected parameters, assign 1 to the grid in which the record is contained (otherwise, 0).

This step is performed in PyCOMPSs, and in order to execute it, it's necessary that the input file to be read is already divided into numFrag parts (number of cores available). Each of them will have the suffix "\_number". For example, if the user submit a execution with the input file 'input.csv' and numFrag equal to 4, it means that the application will look for the files 'input.csv\_0', 'input.csv\_1', 'input.csv\_2' and 'input.csv\_3'.

The parameters are:

 * input  (-i): The input file path.
 * bounds (-b): The bounding box around a city, state, country, or zipcode using geocoding. Format: minx maxy minx maxx  (where y=Latitude and x=Longitude)
 * window (-w): The window time in seconds to take in count (default, 3600) 
 * nday (-l):	 The number of days to generate the sample. (default, 28)
 * ngrid (-g): The organization of the grid. Format: \<n\_lines\> \<n\_columns\>  (default, 50x50)
 * numFrag (-f): Number of workers (cores)  
 * init_time (-s): Initial time (in milis) of the sample (default, 1468738813423)



Example of how submit this application in COMPSs, considering the Curitiba's city:

```sh
date
STARTTIME=$(date +%s)

INPUT=$1
runcompss -g --log_level=info --lang=python $PWD/preprocessing.py \
  -i $INPUT -l 28 -f 4 -s 1468738813423 -g 50 50 -w 3600 \
  -b -25.645386 -25.346736 -49.389339 -49.185225

ENDTIME=$(date +%s)
echo "It took $(($ENDTIME - $STARTTIME)) seconds"
date

```

This application creates the following three files:

1. output\_grids.csv:	The coordenates of each created grid.
2. output\_events.csv:	The number of events recorded at each time point
3. output\_training.csv: The output of the application itself. This file will serve as the entry for the model.


### Requirements files


```
Shapely == 1.6.1
numpy == 1.11.0
```